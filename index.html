<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gerador de Solicitação de RP - JJK RPG</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700&family=Roboto+Mono:wght@400;700&family=Yuji+Syuku&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --bg: #0c0c1a;
      --panel: #13141c;
      --muted: #bfc6e6;
      --accent1: #9b00ff;
      --highlight: #c48fff;
      --text: #e7e9ff;
      --ui: 'Inter', system-ui, sans-serif;
      --title: 'Yuji Syuku', serif;
      --mono: 'Roboto Mono', monospace;
      --glass: rgba(255, 255, 255, 0.03);
      --glass-2: rgba(255, 255, 255, 0.02);
      --success: #00e091;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: var(--ui);
      background-color: var(--bg);
      color: var(--text);
      line-height: 1.6;
      padding: 20px;
      min-height: 100vh;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
    }
    #form-container {
      background: var(--panel);
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 20px;
      margin-bottom: 20px;
    }
    #output-container {
      background: var(--panel);
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 20px;
    }
    fieldset {
      border: 1px solid var(--glass);
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
    }
    legend {
      font-family: var(--title);
      font-size: 1.5em;
      color: var(--highlight);
      padding: 0 10px;
      margin-left: 10px;
    }
    .grid-2 { 
      display: grid; 
      grid-template-columns: 1fr 1fr; 
      gap: 15px; 
    }
    .input-group { 
      display: flex; 
      flex-direction: column; 
      gap: 5px; 
      margin-bottom: 10px; 
    }
    label { 
      font-weight: 500; 
      font-size: 13px; 
      color: var(--muted); 
      text-transform: uppercase; 
      font-family: var(--mono); 
    }
    input[type="text"], input[type="url"], textarea, select {
      background: var(--bg);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 6px;
      padding: 10px;
      color: var(--text);
      font-family: var(--ui);
      font-size: 14px;
    }
    select { font-family: var(--mono); }
    textarea { 
      min-height: 80px; 
      resize: vertical; 
    }
    .note { 
      font-size: 12px; 
      color: var(--muted); 
      opacity: 0.8; 
      margin-top: -5px; 
      margin-bottom: 10px; 
    }
    #output-code {
      width: 100%;
      height: 200px;
      background: var(--bg);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      padding: 15px;
      color: var(--muted);
      font-family: var(--mono);
      font-size: 12px;
      resize: vertical;
      margin-bottom: 10px;
    }
    #copy-btn {
      width: 100%; 
      padding: 12px; 
      border: none; 
      border-radius: 8px; 
      background: var(--success);
      color: var(--panel); 
      font-size: 1em; 
      font-family: var(--ui); 
      font-weight: 700;
      cursor: pointer; 
      transition: background 0.2s;
    }
    #copy-btn:hover { 
      background: #00ffaa; 
    }
    
    textarea::-webkit-scrollbar { 
      width: 8px; 
    }
    textarea::-webkit-scrollbar-track { 
      background: var(--panel); 
    }
    textarea::-webkit-scrollbar-thumb { 
      background-color: var(--accent1); 
      border-radius: 8px; 
    }
    
    @media (max-width: 600px) {
      .grid-2 { 
        grid-template-columns: 1fr; 
      }
      body {
        padding: 10px;
      }
    }
  </style>
</head>
<body>

  <div class="container">
    
    <div id="form-container">
      <fieldset>
        <legend>Informações da Solicitação</legend>
        <div class="grid-2">
          <div class="input-group">
            <label for="f-jogador">Jogador</label>
            <input type="text" id="f-jogador" placeholder="Seu nome de usuário">
          </div>
          <div class="input-group">
            <label for="f-personagem">Personagem</label>
            <input type="text" id="f-personagem" placeholder="Nome do personagem">
          </div>
        </div>
        
        <div class="grid-2">
          <div class="input-group">
            <label for="f-tipo">Tipo de Atividade</label>
            <select id="f-tipo">
              <option value="Missão">Missão</option>
              <option value="Quest">Quest</option>
              <option value="Evento">Evento</option>
              <option value="Treino Supervisionado">Treino Supervisionado</option>
            </select>
          </div>
          <div class="input-group">
            <label for="f-grau">Grau/Nível</label>
            <select id="f-grau">
              <option value="Grau 4">Grau 4</option>
              <option value="Grau 3">Grau 3</option>
              <option value="Grau 2">Grau 2</option>
              <option value="Grau 1">Grau 1</option>
              <option value="Semi-Especial">Semi-Especial</option>
              <option value="Especial">Especial</option>
            </select>
          </div>
        </div>
        
        <div class="grid-2">
          <div class="input-group">
            <label for="f-formato">Formato</label>
            <select id="f-formato">
              <option value="Autonarrado">Autonarrado</option>
              <option value="Mestrado">Mestrado</option>
            </select>
          </div>
          <div class="input-group">
            <label for="f-barra-status">Barra de Status Inimigos</label>
            <select id="f-barra-status">
              <option value="Com Barra">Com Barra</option>
              <option value="Sem Barra">Sem Barra</option>
            </select>
          </div>
        </div>
        
        <div class="input-group">
          <label for="f-objetivo">Objetivo</label>
          <input type="text" id="f-objetivo" placeholder="O que se pretende alcançar com esta atividade">
        </div>
        
        <div class="input-group">
          <label for="f-participantes">Participantes</label>
          <input type="text" id="f-participantes" placeholder="Lista de jogadores (se aplicável)">
        </div>
        
        <div class="input-group">
          <label for="f-descricao">Descrição</label>
          <textarea id="f-descricao" placeholder="Breve descrição do enredo, contexto e desenvolvimento proposto para a atividade..."></textarea>
        </div>
      </fieldset>
    </div>

    <div id="output-container">
      <textarea id="output-code" readonly>O código da sua solicitação aparecerá aqui...</textarea>
      <button id="copy-btn">Copiar Código</button>
    </div>
  </div>

  <script>
    // --- SCRIPT PRINCIPAL ---
    document.addEventListener('DOMContentLoaded', function() {
      
      const form = document.getElementById('form-container');
      const copyBtn = document.getElementById('copy-btn');
      const outputArea = document.getElementById('output-code');
      const allInputs = form.querySelectorAll('input, textarea, select');
      const storageKey = 'solicitacaoRPData_v1';

      // --- FUNÇÕES UTILITÁRIAS ---
      function getVal(id) { 
        const element = document.getElementById(id);
        return element ? element.value.trim() : ''; 
      }
      
      function escapeHTML(str) { 
        if (!str) return ''; 
        return str.replace(/</g, "&lt;").replace(/>/g, "&gt;"); 
      }
      
      function escapeAttr(str) { 
        if (!str) return ''; 
        return str.replace(/"/g, "&quot;"); 
      }

      // --- SISTEMA DE ALTURA DINÂMICA ---
      function calculateAndSendHeight() {
        const body = document.body;
        const html = document.documentElement;
        
        const height = Math.max(
          body.scrollHeight, 
          body.offsetHeight,
          html.clientHeight,
          html.scrollHeight,
          html.offsetHeight
        );
        
        // [CORRIGIDO] Enviar a mensagem para a URL do seu fórum
        window.parent.postMessage({ 
          frameHeight: height 
        }, 'https://goldenagejjkrpg.forumeiros.com'); 
      }

      // --- GERAÇÃO DO CÓDIGO ---
      function generateAndDisplayCode() {
        try {
          const jogador = escapeHTML(getVal('f-jogador'));
          const personagem = escapeHTML(getVal('f-personagem'));
          const tipo = escapeHTML(getVal('f-tipo'));
          const grau = escapeHTML(getVal('f-grau'));
          const objetivo = escapeHTML(getVal('f-objetivo'));
          const formato = escapeHTML(getVal('f-formato'));
          const barraStatus = escapeHTML(getVal('f-barra-status'));
          const participantes = escapeHTML(getVal('f-participantes'));
          const descricao = escapeHTML(getVal('f-descricao'));

          // [NOTA] O ?v=1.0 é um "cache buster" para garantir que o CSS atualize
          const codigoTemplate = '<link href="https://gaaaaaaaaabs.github.io/goldenagerepositor.io/solicitacao.css?v=1.0" rel="stylesheet" type="text/css"><div class="solicitacao-request"><div class="solicitacao-header"><div class="solicitacao-title"><h3>SOLICITAÇÃO DE ABERTURA</h3><span class="solicitacao-status" data-status="1">Status: Pendente</span></div></div><div class="solicitacao-content"><div class="solicitacao-field"><span class="solicitacao-label">Jogador:</span><span class="solicitacao-value">' + (jogador || '...') + '</span></div><div class="solicitacao-field"><span class="solicitacao-label">Personagem:</span><span class="solicitacao-value">' + (personagem || '...') + '</span></div><div class="solicitacao-field"><span class="solicitacao-label">Tipo de Atividade:</span><span class="solicitacao-value">' + (tipo || '...') + '</span></div><div class="solicitacao-field"><span class="solicitacao-label">Grau/Nível:</span><span class="solicitacao-value">' + (grau || '...') + '</span></div><div class="solicitacao-field"><span class="solicitacao-label">Objetivo:</span><span class="solicitacao-value">' + (objetivo || '...') + '</span></div><div class="solicitacao-field"><span class="solicitacao-label">Formato:</span><span class="solicitacao-value">' + (formato || '...') + '</span></div><div class="solicitacao-field"><span class="solicitacao-label">Participantes:</span><span class="solicitacao-value">' + (participantes || '...') + '</span></div><div class="solicitacao-field full-width"><span class="solicitacao-label">Descrição:</span><span class="solicitacao-value">' + (descricao || '...') + '</span></div></div><div class="solicitacao-footer"><div class="solicitacao-master"><b>Mestre Responsável:</b><span style="color: #c48fff;"> Aguardando designação</span></div><div class="solicitacao-notes"><b>Notas:</b><span style="color: #c48fff;"> Nenhuma nota.</span></div></div></div>';

          outputArea.value = codigoTemplate;
        
        } catch (e) {
          console.error("Erro ao gerar código:", e);
          outputArea.value = "Erro! Verifique os valores do formulário.";
        }
      }
      
      // --- SALVAMENTO LOCAL ---
      function saveDataToLocalStorage() {
        const data = {};
        allInputs.forEach(input => {
          if(input.id) {
            data[input.id] = input.value;
          }
        });
        localStorage.setItem(storageKey, JSON.stringify(data));
      }

      function loadDataFromLocalStorage() {
        try {
          const data = JSON.parse(localStorage.getItem(storageKey));
          if (data) {
            allInputs.forEach(input => {
              if (input.id && data[input.id] !== undefined) {
                input.value = data[input.id];
              }
            });
          }
        } catch (e) {
          console.log('Nenhum dado salvo encontrado');
        }
        generateAndDisplayCode();
      }

      // --- OBSERVADORES DE MUDANÇA ---
      const resizeObserver = new ResizeObserver(function() {
        calculateAndSendHeight();
      });

      const mutationObserver = new MutationObserver(function() {
        setTimeout(calculateAndSendHeight, 10);
      });

      // --- INICIALIZAÇÃO ---
      function initialize() {
        loadDataFromLocalStorage();
        
        resizeObserver.observe(document.body);
        mutationObserver.observe(document.body, {
          childList: true,
          subtree: true,
          attributes: true,
          attributeFilter: ['style', 'class']
        });
        
        setTimeout(calculateAndSendHeight, 100);
        
        form.addEventListener('input', function() {
          generateAndDisplayCode();
          saveDataToLocalStorage();
          setTimeout(calculateAndSendHeight, 50);
        });

        copyBtn.addEventListener('click', function() {
          outputArea.select();
          document.execCommand('copy');
          const originalText = copyBtn.textContent;
          copyBtn.textContent = 'Copiado!';
          setTimeout(() => {
            copyBtn.textContent = originalText;
          }, 2000);
        });
        
        window.addEventListener('resize', function() {
          setTimeout(calculateAndSendHeight, 100);
        });
      }

      initialize();

    });
  </script>
</body>
</html>
